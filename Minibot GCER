#include <kipr/botball.h>

//Integers:
	//Motors:
		int lm = 0;
		int rm = 1;
		int pulley = 3;
		//Motor speeds:
			int lm5 = 100;
            int rm5 = 93.5; //original before rebalancing 92
            int lm4 = 80;
            int rm4 = 74; //73.5
            int lm3 = 60;
            int rm3 = 56; //55.5
            int lm2 = 40;
            int rm2 = 37.125; //36.875
            int lm1 = 20;
            int rm1 = 19.5; //19
	//Servos:
		int swiper = 0;
			int swiper_front = 1948;
			int swiper_back = 230;
		int twister = 2;
			int twister_straight = 1306;
			int twister_turned = 220;
	//Sensors:
		//Analog:
			int light = 0;
		//Digital:
			int touch = 3;
int main()
{
	//wait_for_light(light);
    //shut_down_in(119);
    
    //Wait in the Disaster Relief Zone for the create to get out of the way
    //msleep(????);
    
    //Drive forward until it touches the pvc side in the Utility Zone
  	while (digital(touch) == 0)
    {
    	motor(rm,rm5);
    	motor(lm,lm5);
    }
    ao();
    
    msleep(300);
    
    //back up a smidge to turn w/out hitting claw on pole
    motor(rm,-rm5);
    motor(lm,-lm5);
    msleep(600);
    ao();
    
    msleep(300);
    
    //turn 90 degrees back and left
    motor(rm,rm3);
    motor(lm,-lm3);
    msleep(1130);
    ao();
    
    msleep(300);
	
    //back up against on the other pvc of the Utility Zone to straighten up
    motor(rm,-rm5);
    motor(lm,-lm5);
    msleep(1400);
    ao();
    
    msleep(300);
    
    //drive forward towards the orange pipe until it hits the pvc to the right of it
     while (digital(touch) == 0)
    {
    	motor(rm,rm5);
    	motor(lm,lm5);
    }
    ao();
    
    msleep(300);
    
    //back up to prepare to turn and back up
    motor(rm,-rm5);
    motor(lm,-lm5);
    msleep(1450);
    ao();
    
    msleep(300);

    //turn 90 degrees back and left to back up into pipe
    motor(rm,rm3);
    motor(lm,-lm3);
    msleep(1220);
    ao();
    
    msleep(300);
    
    //back up against the pipe
    motor(rm,-rm5);
    motor(lm,-lm5);
    msleep(1500);
    ao();
    
    msleep(300);
    
    //go straight to move right in front of the gas valve
    motor(rm,rm3);
    motor(lm,lm3);
    msleep(3200);
    ao();
    
    msleep(300);
    
    //turn 90 degrees towared the gas valve
    motor(rm,-rm3);
    motor(lm,lm3);
    msleep(1100);
    ao();
    
    msleep(300);
    
    //Drive forward to snap onto the gas valve with the fixed claw
    motor(rm,rm2);
    motor(lm,lm2);
    msleep(3600);
    ao();
    
    msleep(300);

    //Lift up the pulley in order to remove the gas valve from the pvc
    motor(3,25);
    msleep(11000);
    ao();
    
    msleep(300);
    
    //Back up all the way
    motor(rm,-rm5);
    motor(lm,-lm5);
    msleep(6500);
    ao();
    
    msleep(300);
    
    set_servo_position(twister,twister_turned);
    enable_servo(twister);
    msleep(300);
    set_servo_position(swiper,swiper_front);
    enable_servo(swiper);
    msleep(300);
    
    //go forward a smidge to have enough room to turn
    motor(rm,rm4);
    motor(lm,lm4);
    msleep(2300);
    ao();
    
    msleep(300);
    
    //Turn 90 degrees left and back
    motor(rm,rm3);
    motor(lm,-lm3);
    msleep(1220);
    ao();
    
    msleep(300);
    
    //back up against the pipe the SAME
    motor(rm,-rm5);
    motor(lm,-lm5);
    msleep(3300);
    ao();
    
    msleep(300);

    //Drive straight until running into the pipe by the gas valve
  	motor(rm,rm5);
    motor(lm,lm5);
    msleep(2200);
    ao();
    
    set_servo_position(swiper,swiper_back);
    
    msleep(300);
    
    //Turn 90 degrees to face the pipe
    motor(rm,rm3);
    motor(lm,-lm3);
    msleep(1230);
    ao();

    msleep(300);
    
    while (digital(touch) == 0)
    {
    	motor(rm,rm3);
    	motor(lm,lm3);
    }
    ao();
    
    msleep(300);
    
    //Navitage the gas valve onto the pipe:
    	//Lower pulley a smidge
    	motor(pulley,25);
    	msleep(2000);
    	ao();
    
    	//Lower pulley a smidge
    	motor(pulley,-25);
    	msleep(2200);
    	ao();
    	
    	msleep(300);
    
    	motor(rm,-rm3);
    	motor(lm,-rm3);
    	msleep(500);
    	ao();
    
    	msleep(300);
    
    	//Shimey shimey
    	motor(lm,-lm3);
    	msleep(2000);
    	ao();
    	
    	msleep(300);
    
    	motor(rm,rm1);
    	motor(lm,lm1);
    	msleep(500);
    	ao();
    
    	msleep(300);
    
    	motor(lm,-lm3);
    	msleep(2000);
    	ao();
    
    	msleep(300);
    
    	motor(rm,-rm4);
    	motor(lm,-lm4);
    	msleep(200);
    	ao();
    
    	msleep(300);
    	
    	motor(rm,rm3);
    	msleep(400);
    	ao();
    
    //Back up to let go of gas valve
    motor(lm,-lm5);
    motor(rm,-rm5);
    msleep(1000);
    ao();
    
    return 0;
}
